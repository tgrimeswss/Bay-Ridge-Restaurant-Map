function initMap(){var e=[{featureType:"water",stylers:[{color:"#FFFFFF"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]}];map=new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(40.6251388,-74.0282899),zoom:14,styles:e});var o=new google.maps.InfoWindow,i=function(){r(this,o)},r=(function(){for(var e=0;e<locations.length;e++){var o=locations[e].location,r=locations[e].title;marker=new google.maps.Marker({position:o,map:map,title:r,website:locations[e].website,imgs:locations[e].imgs,resID:locations[e].resID,animation:google.maps.Animation.DROP,icon:"forkknife.png",id:e}),locations[e].marker=marker,ViewModel.markerArray()[e].marker=marker,marker.popInfoWindow=i,marker.addListener("click",i),markers.push(marker)}}(),function(e,o){if(o.marker!=e){o.setContent(""),o.marker=e,o.addListener("closeclick",function(){o.marker=null});var i=new google.maps.StreetViewService,r=50,t=function(i,r){if(r==google.maps.StreetViewStatus.OK){console.log("Name: "+e.title+". GPS: "+e.position);var t=i.location.latLng,a=google.maps.geometry.spherical.computeHeading(t,e.position);o.setContent('<div style="text-align:center;"><h2><a style="text-decoration:none;color:black;" href="'+e.website+'">'+e.title+'</a></h2><div style="border: solid red 1px;"><div id="pano"</div></div><div id="listView" style="float:right;"><h3>Zomato Reviews</h3>'+reviews+"</div>");var s={position:t,pov:{heading:a,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),s)}else o.setContent("<div>"+e.title+"</div><div>No Street View Found</div>")};i.getPanoramaByLocation(e.position,r,t),o.open(map,e),map.panTo(e.position),map.setZoom(15),e.setAnimation(google.maps.Animation.DROP)}})}var map,markers=[],reviews=[],zomatoReviews=function(e,o){$.ajax({dataType:"json",url:"https://developers.zomato.com/api/v2.1/reviews?res_id="+e.marker.resID,headers:{"user-key":"19b6f28a79ec4858856da336e1fee593"},success:function(o,i,r){this.clearReviews(),ViewModel.reviewList.removeAll();for(var t=0;t<o.user_reviews.length;t++)ViewModel.reviewList.push('"'+o.user_reviews[t].review.review_text+'"'),reviews.push('"'+o.user_reviews[t].review.review_text+'"');e.marker.popInfoWindow()},error:function(e,o,i){alert("Hmm.. There seems to a problem with our Zomato API. Check back in with us later. We are working on to fix it.")},clearReviews:function(){reviews.splice(0,reviews.length)}})},Location=function(e){this.title=e.title},ViewModel={markerArray:ko.observableArray(),query:ko.observable(""),reviewList:ko.observableArray(),search:function(e){for(var o=0;o<markers.length;o++)markers[o].setVisible(!1);ViewModel.reviewList.removeAll(),ViewModel.markerArray.removeAll();for(var i in locations)locations[i].title.toLowerCase().indexOf(e.toLowerCase())>=0&&(ViewModel.markerArray.push(locations[i]),markers[i].setVisible(!0))},showAllmarkers:function(){for(var e=0;e<markers.length;e++)markers[e].setVisible(!0),markers[e].setAnimation(google.maps.Animation.DROP)},makeLocations:function(e){var o=this;e.forEach(function(e){o.markerArray.push(new Location(e))})},goToLocation:function(e,o){for(var i=0;i<markers.length;i++)markers[i].setVisible(!1);e.marker.setVisible(!0),zomatoReviews(e)}};ViewModel.makeLocations(locations),ViewModel.query.subscribe(ViewModel.search),ko.applyBindings(ViewModel);
