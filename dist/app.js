function initMap(){var e=[{featureType:"water",stylers:[{color:"#FFFFFF"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]}];map=new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(40.6251388,-74.0282899),zoom:14,styles:e});var o=new google.maps.InfoWindow,r=function(){i(this,o)},i=(function(){for(var e=0;e<locations.length;e++){var o=locations[e].location,i=locations[e].title;marker=new google.maps.Marker({position:o,visible:!1,map:map,title:i,website:locations[e].website,imgs:locations[e].imgs,resID:locations[e].resID,animation:google.maps.Animation.DROP,icon:"forkknife.png",id:e}),locations[e].marker=marker,ViewModel.markerArray()[e].marker=marker,marker.popInfoWindow=r,marker.addListener("click",r),markers.push(marker)}}(),function(e,o){if(o.marker!=e){o.setContent(""),o.marker=e,o.addListener("closeclick",function(){o.marker=null});(new google.maps.StreetViewService).getPanoramaByLocation(e.position,50,function(r,i){if(i==google.maps.StreetViewStatus.OK){console.log("Name: "+e.title+". GPS: "+e.position);var a=r.location.latLng,t=google.maps.geometry.spherical.computeHeading(a,e.position);o.setContent('<div style="text-align:center;"><h2><a style="text-decoration:none;color:black;" href="'+e.website+'">'+e.title+'</a></h2><div id="pano"></div>');var n={position:a,pov:{heading:t,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),n)}else o.setContent("<div>"+e.title+"</div><div>No Street View Found</div>")}),o.open(map,e),map.panTo(e.position),map.setZoom(15),e.setAnimation(google.maps.Animation.DROP)}})}var map,markers=[];window.onerror=function(e,o,r){return alert("Hmm.. There seems to be a problem loading this page.\n\nMessage: "+e+"\nURL : "+o+"\nLine : "+r),!0},mapError=function(){alert("There seems to be a map error")};var Location=function(e){this.title=e.title},ViewModel={markerArray:ko.observableArray(),query:ko.observable(""),reviewList:ko.observableArray(),zomatoReviews:function(e){$.ajax({dataType:"json",url:"https://developers.zomato.com/api/v2.1/reviews?res_id="+e.marker.resID,headers:{"user-key":"19b6f28a79ec4858856da336e1fee593"},success:function(e,o,r){console.log(o),ViewModel.reviewList.removeAll();for(var i=0;i<e.user_reviews.length;i++)ViewModel.reviewList.push('"'+e.user_reviews[i].review.review_text+'"');console.log(e)}})},search:function(e){ViewModel.reviewList.removeAll(),ViewModel.markerArray.removeAll();for(var o in locations)locations[o].title.toLowerCase().indexOf(e.toLowerCase())>=0&&ViewModel.markerArray.push(locations[o])},showAllmarkers:function(){for(var e=0;e<markers.length;e++)markers[e].setVisible(!0),markers[e].setAnimation(google.maps.Animation.DROP)},hideAllmarkers:function(){for(var e=0;e<markers.length;e++)markers[e].setVisible(!1)},makeLocations:function(e){var o=this;e.forEach(function(e){o.markerArray.push(new Location(e))})},goToLocation:function(e,o){for(var r=0;r<markers.length;r++)markers[r].setVisible(!1);e.marker.setVisible(!0),ViewModel.zomatoReviews(e),e.marker.popInfoWindow()}};ViewModel.makeLocations(locations),ViewModel.query.subscribe(ViewModel.search),ko.applyBindings(ViewModel);
